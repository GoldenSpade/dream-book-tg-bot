// fortune_tellings/time_reading/timeReading.js

function getNumerologicalValue(time) {
  const digits = time
    .toString()
    .split('')
    .filter((char) => /\d/.test(char))
    .map(Number)

  let sum = digits.reduce((acc, val) => acc + val, 0)

  while (![10, 11, 22].includes(sum) && sum > 9) {
    sum = sum
      .toString()
      .split('')
      .map(Number)
      .reduce((acc, val) => acc + val, 0)
  }

  return sum
}

function isPalindrome(timeString) {
  const digitsOnly = timeString.replace(/[^\d]/g, '')
  return digitsOnly === digitsOnly.split('').reverse().join('')
}

function isRepeated(timeString) {
  const [h, m, s] = timeString.split(':')
  return h === m && m === s
}

function getTimeFortune() {
  const now = new Date()
  const timeString = `${now.getHours().toString().padStart(2, '0')}:${now
    .getMinutes()
    .toString()
    .padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`

  const value = getNumerologicalValue(timeString)

  const parts = []

  // –ó–µ—Ä–∫–∞–ª—å–Ω—ã–µ
  if (isPalindrome(timeString)) {
    parts.push(
      'ü™û *–ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è* ‚Äî –í—Å–µ–ª–µ–Ω–Ω–∞—è –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–≤–æ–∏ –º—ã—Å–ª–∏. –í—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–±—è —Å–∞–º–æ–≥–æ.'
    )
  }

  // –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è
  if (isRepeated(timeString)) {
    parts.push(
      'üîÇ *–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á–∏—Å–ª–∞* ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏—á–Ω–æ—Å—Ç—å –≤–æ –≤—Å—ë–º. –°–µ–π—á–∞—Å –º–æ–∂–Ω–æ –∑–∞–≥–∞–¥—ã–≤–∞—Ç—å –∂–µ–ª–∞–Ω–∏—è.'
    )
  }

  // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è
  const meanings = {
    1: 'üî• –°–µ–π—á–∞—Å –≤—Ä–µ–º—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã –∏ –ª–∏–¥–µ—Ä—Å—Ç–≤–∞. –£ —Ç–µ–±—è –µ—Å—Ç—å —à–∞–Ω—Å –Ω–∞—á–∞—Ç—å —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ–µ. –ù–µ —É–ø—É—Å—Ç–∏ –º–æ–º–µ–Ω—Ç.',
    2: 'ü§ù –î–µ–Ω—å –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–∞. –ë—É–¥—å –≤–Ω–∏–º–∞—Ç–µ–ª–µ–Ω(–Ω–∞) –∫ –¥—Ä—É–≥–∏–º, –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–π, –∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π. –°–∏–ª–∞ ‚Äî –≤ —Å–æ—é–∑–µ.',
    3: 'üé≠ –ò–¥–µ–∏ –≤–∏—Ç–∞—é—Ç –≤ –≤–æ–∑–¥—É—Ö–µ. –ü—Ä–æ—è–≤–∏ —Å–µ–±—è: –ø–∏—à–∏, –ø–æ–π, —Ç–≤–æ—Ä–∏ ‚Äî —Ç–µ–±—è —É—Å–ª—ã—à–∞—Ç.',
    4: 'üèó –ù–∞–¥—ë–∂–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è. –ü–æ—Å—Ç—Ä–æ–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –±—É–¥—É—â–µ–≥–æ. –°–ø–µ—à–∫–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–∏ –∫ —á–µ–º—É.',
    5: 'üå™ –í–µ—Ç–µ—Ä –ø–µ—Ä–µ–º–µ–Ω —Ä—è–¥–æ–º. –ì–æ—Ç–æ–≤—å—Å—è –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º—É –ø–æ–≤–æ—Ä–æ—Ç—É. –ë—É–¥—å –≥–∏–±–∫–∏–º(–æ–π) –∏ –º–æ–±–∏–ª—å–Ω—ã–º(–æ–π).',
    6: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –í—Ä–µ–º—è –¥–ª—è —Å–µ–º—å–∏, –ª—é–±–≤–∏ –∏ –∑–∞–±–æ—Ç—ã. –ì–∞—Ä–º–æ–Ω–∏—è ‚Äî —Ç–≤–æ–π —â–∏—Ç —Å–µ–≥–æ–¥–Ω—è.',
    7: 'üßò‚Äç‚ôÇÔ∏è –£–≥–ª—É–±–∏—Å—å –≤ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è. –û—Ç–≤–µ—Ç –Ω–µ —Å–Ω–∞—Ä—É–∂–∏, –∞ –≤–Ω—É—Ç—Ä–∏. –¢–∏—à–∏–Ω–∞ ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ —è—Å–Ω–æ—Å—Ç–∏.',
    8: 'üíº –î–µ–Ω—å, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –∫–∞—Ä—å–µ—Ä–æ–π, –¥–µ–Ω—å–≥–∞–º–∏ –∏ –≤–ª–∞—Å—Ç—å—é. –ü—Ä–∏–Ω–∏–º–∞–π —Ä–µ—à–µ–Ω–∏—è —Å —Ä–∞—Å—á—ë—Ç–æ–º.',
    9: 'üîö –ó–∞–≤–µ—Ä—à–∏ –Ω–∞—á–∞—Ç–æ–µ. –û—Å–≤–æ–±–æ–¥–∏ –º–µ—Å—Ç–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ. –û—Ç–ø—É—Å—Ç–∏—Ç—å ‚Äî —Ç–æ–∂–µ –º—É–¥—Ä–æ—Å—Ç—å.',
    10: 'üöÄ –ß–∏—Å–ª–æ —Å–∏–ª—ã. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è ‚Äî –±–µ—Ä–∏ –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –¢—ã –≥–æ—Ç–æ–≤(–∞).',
    11: '‚ú® –¢—ã –Ω–∞ –¥—É—Ö–æ–≤–Ω–æ–π –≤–æ–ª–Ω–µ. –ü—Ä–∏—Å–ª—É—à–∞–π—Å—è –∫ –∑–Ω–∞–∫–∞–º, –¥–æ–≤–µ—Ä—å—Å—è –∏–Ω—Ç—É–∏—Ü–∏–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫.',
    13: 'üïØ –¢–∞–π–Ω–∞ –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è. –ú–æ–∂–µ—Ç –∫–∞–∑–∞—Ç—å—Å—è —Ö–∞–æ—Å–æ–º, –Ω–æ –≤–Ω—É—Ç—Ä–∏ ‚Äî —Ä–æ—Å—Ç. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ –±–æ—è—Ç—å—Å—è.',
    22: 'üåü –ú–∞—Å—Ç–µ—Ä-–≤—Ä–µ–º—è. –¢–≤–æ–∏ –∏–¥–µ–∏ –º–æ–≥—É—Ç –æ–±—Ä–µ—Å—Ç–∏ —Ñ–æ—Ä–º—É. –°—Ç—Ä–æ–π —Å —Ä–∞–∑–º–∞—Ö–æ–º ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—è–¥–æ–º.',
    33: 'üí´ –í—ã—Å—à–µ–µ —Å–ª—É–∂–µ–Ω–∏–µ. –ü–æ–º–æ–≥–∏ –¥—Ä—É–≥–∏–º ‚Äî –∏ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–µ—á—Ç–æ –±–æ–ª—å—à–µ–µ. –≠—Ç–æ –¥–µ–Ω—å –≤–µ–ª–∏–∫–æ–π –º–∏—Å—Å–∏–∏.',
  }

  parts.push(meanings[value] || 'üåÄ –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤—Ä–µ–º–µ–Ω–∏.')

  return `üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${timeString}\n\n` + parts.join('\n')
}

export { getTimeFortune }

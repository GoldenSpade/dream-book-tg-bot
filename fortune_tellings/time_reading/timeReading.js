// fortune_tellings/time_reading/timeReading.js

function getNumerologicalValue(time) {
  const digits = time
    .toString()
    .split('')
    .filter((char) => /\d/.test(char))
    .map(Number)

  let sum = digits.reduce((acc, val) => acc + val, 0)

  while (![10, 11, 22].includes(sum) && sum > 9) {
    sum = sum
      .toString()
      .split('')
      .map(Number)
      .reduce((acc, val) => acc + val, 0)
  }

  return sum
}

function isPalindrome(timeString) {
  const digitsOnly = timeString.replace(/[^\d]/g, '')
  return digitsOnly === digitsOnly.split('').reverse().join('')
}

function isRepeated(timeString) {
  const [h, m, s] = timeString.split(':')
  return h === m && m === s
}

function getTimeFortune() {
  const now = new Date()
  const timeString = `${now.getHours().toString().padStart(2, '0')}:${now
    .getMinutes()
    .toString()
    .padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`

  const value = getNumerologicalValue(timeString)

  const parts = []

  // –ó–µ—Ä–∫–∞–ª—å–Ω—ã–µ
  if (isPalindrome(timeString)) {
    parts.push(
      'ü™û *–ó–µ—Ä–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è* ‚Äî –í—Å–µ–ª–µ–Ω–Ω–∞—è –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–≤–æ–∏ –º—ã—Å–ª–∏. –í—Å—ë –ø—Ä–æ–∏—Å—Ö–æ–¥—è—â–µ–µ ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–±—è —Å–∞–º–æ–≥–æ.'
    )
  }

  // –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è
  if (isRepeated(timeString)) {
    parts.push(
      'üîÇ *–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —á–∏—Å–ª–∞* ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏—á–Ω–æ—Å—Ç—å –≤–æ –≤—Å—ë–º. –°–µ–π—á–∞—Å –º–æ–∂–Ω–æ –∑–∞–≥–∞–¥—ã–≤–∞—Ç—å –∂–µ–ª–∞–Ω–∏—è.'
    )
  }

  // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏—è
  const meanings = {
    1: 'üî¢ –°–µ–π—á–∞—Å –≤—Ä–µ–º—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã. –ù–∞—á–Ω–∏ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ.',
    2: 'ü§ù –í—Ä–µ–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞. –ù–µ –¥–µ–π—Å—Ç–≤—É–π –≤ –æ–¥–∏–Ω–æ—á–∫—É.',
    3: 'üé® –ü—Ä–æ—è–≤–∏ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥. –ò–¥–µ–∏ –º–æ–≥—É—Ç –≤–æ–ø–ª–æ—Ç–∏—Ç—å—Å—è.',
    4: 'üèó –ó–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç. –†–∞–±–æ—Ç–∞–π –Ω–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—É.',
    5: 'üå™ –í—Ä–µ–º—è –ø–µ—Ä–µ–º–µ–Ω. –ë—É–¥—å –≥–∏–±–∫–∏–º –∏ –æ—Ç–∫—Ä—ã—Ç—ã–º.',
    6: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –±–ª–∏–∑–∫–∏—Ö. –ò—â–∏ –≥–∞—Ä–º–æ–Ω–∏—é.',
    7: 'üßò‚Äç‚ôÇÔ∏è –í—Ä–µ–º—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π. –°–ª—É—à–∞–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–æ–ª–æ—Å.',
    8: 'üí∞ –§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —ç–Ω–µ—Ä–≥–∏—è. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–æ—Å—Ç–∞ –∏ —É—Å–ø–µ—Ö–∞.',
    9: 'üîö –ó–∞–≤–µ—Ä—à–∞–π –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–µ. –û—Å–≤–æ–±–æ–∂–¥–∞–π –º–µ—Å—Ç–æ –Ω–æ–≤–æ–º—É.',
    10: 'üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–æ—Å—Ç–∞. –£–¥–∞—á–∞ –Ω–∞ —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ.',
    11: '‚ú® –í—ã—Å—à–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä—è–¥–æ–º. –î–æ–≤–µ—Ä—å—Å—è –∏–Ω—Ç—É–∏—Ü–∏–∏.',
    22: 'üåü –ú–∞—Å—Ç–µ—Ä-–≤—Ä–µ–º—è. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–µ–ª–∏–∫–æ–≥–æ —Å–≤–µ—Ä—à–µ–Ω–∏—è.',
  }

  parts.push(meanings[value] || 'üåÄ –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –≤—Ä–µ–º–µ–Ω–∏.')

  return `üïí –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${timeString}\n` + parts.join('\n')
}

export { getTimeFortune }
